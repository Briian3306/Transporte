<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportar Incidente</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="dashboard.html" class="text-gray-400 hover:text-gray-600 mr-4">
                        ‚Üê Volver
                    </a>
                    <h1 class="text-xl font-bold text-gray-900">üö® Reportar Incidente</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto py-6 px-4">

        <!-- Form Simple -->
        <form id="incidenteForm" class="bg-white shadow rounded-lg p-6">
            <div class="space-y-6">
                
                <!-- Datos B√°sicos -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha *</label>
                        <input type="date" id="fecha" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hora *</label>
                        <input type="time" id="hora" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Qui√©n llama *</label>
                        <input type="text" id="nombre" placeholder="Nombre completo" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono *</label>
                        <input type="tel" id="telefono" placeholder="+54 9 11 1234-5678" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a del llamante *</label>
                    <select id="categoria" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="">Seleccionar...</option>
                        <option value="chofer">üöõ Chofer</option>
                        <option value="cliente">üë§ Cliente</option>
                        <option value="policia">üëÆ Polic√≠a</option>
                        <option value="bomberos">üöí Bomberos</option>
                        <option value="tercero">üë• Tercero</option>
                        <option value="otro">‚ùì Otro</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Motivo del llamado *</label>
                    <textarea id="motivo" placeholder="¬øPor qu√© est√° llamando? Describa brevemente la situaci√≥n..." required class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">¬øD√≥nde est√°? *</label>
                    <textarea id="ubicacion" placeholder="Ubicaci√≥n exacta, km, referencias..." required class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                </div>

                <div class="grid grid-cols-1">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Patente</label>
                        <input type="text" id="patente" placeholder="ABC-123" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de incidente *</label>
                        <select id="tipo" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">Seleccionar...</option>
                            <option value="accidente" data-peso="5">üöó Accidente</option>
                            <option value="robo" data-peso="8">‚ö†Ô∏è Robo/Amenaza</option>
                            <option value="averia" data-peso="2">‚öôÔ∏è Aver√≠a</option>
                            <option value="derrame" data-peso="10">üî• Derrame/Incendio</option>
                            <option value="documentacion" data-peso="1">üìÑ Documentaci√≥n</option>
                            <option value="operaciones_cliente" data-peso="1">üè¢ Operaciones de Cliente</option>
                            <option value="combustible" data-peso="1">‚õΩ Combustible</option>
                            <option value="consulta" data-peso="1">üìã Consulta</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Subtipo de incidente</label>
                        <select id="subtipo" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">Seleccionar subtipo...</option>
                        </select>
                    </div>
                </div>

                <!-- Clasificaci√≥n Autom√°tica -->
                <div id="clasificacion" class="hidden p-4 rounded-md">
                    <h3 class="font-medium mb-2" id="clasificacionTitulo"></h3>
                    <p class="text-sm" id="clasificacionDescripcion"></p>
                </div>

                <!-- Indicaciones de Seguridad -->
                <div id="indicacionesContainer" class="hidden border rounded-md p-4">
                    <div id="indicacionesLista" class="space-y-2">
                        <!-- Las indicaciones se mostrar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>



            </div>

            <!-- Botones -->
            <div class="flex justify-between mt-8">
                <button type="button" onclick="window.location.href='dashboard.html'" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400">
                    Cancelar
                </button>
                <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700">
                    Enviar Reporte
                </button>
            </div>
        </form>
    </main>

    <script>
        // Configuraci√≥n para Make
        const MAKE_WEBHOOK_URL = 'https://hook.us2.make.com/13r45n327bvgejvy9vxjaj63rtlx6ec3';
        
        // Configuraci√≥n de niveles de riesgo (directamente en el HTML)
        const NIVELES_RIESGO = {
            CRITICO: { 
                puntajeMinimo: 20, 
                color: "red", 
                titulo: "üö® CR√çTICO", 
                responsable: "Diego y Damian", 
                tiempoRespuesta: "Inmediato"
            },
            ALTO: { 
                puntajeMinimo: 15, 
                color: "orange", 
                titulo: "‚ö†Ô∏è ALTO", 
                responsable: "Guardia Log√≠stica / Mantenimiento", 
                tiempoRespuesta: "15 minutos"
            },
            MEDIO: { 
                puntajeMinimo: 10, 
                color: "yellow", 
                titulo: "‚ö° MEDIO", 
                responsable: "Guardia Log√≠stica / Mantenimiento", 
                tiempoRespuesta: "2 horas"
            },
            BAJO: { 
                puntajeMinimo: 0, 
                color: "green", 
                titulo: "‚úÖ BAJO", 
                responsable: "Horario de oficina", 
                tiempoRespuesta: "24 horas"
            }
        };

        // Configuraci√≥n de subtipos por tipo de incidente con indicaciones y acciones espec√≠ficas para operador de seguridad
        const SUBTIPOS_INCIDENTE = {
            accidente: [
                { 
                    value: "choque_simple_sin_heridos", 
                    text: "Choque simple sin heridos", 
                    peso: 3,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Mantener calma y no moverse del lugar",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: NO admitir responsabilidad ni discutir con el otro conductor",
                        "INSTRUIR AL CHOFER: Recopilar datos del otro veh√≠culo (patente, conductor, seguro)",
                        "INSTRUIR AL CHOFER: Tomar fotos del accidente y da√±os",
                        "VERIFICAR: Que no hay heridos ni da√±os a terceros",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto"
                    ],
                    acciones: [
                        "Enviar informaci√≥n por WhatsApp a Log√≠stica para informar sobre el incidente",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "choque_simple_con_heridos", 
                    text: "Choque simple con heridos", 
                    peso: 8,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO mover a los heridos bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: Tomar fotos de la escena sin interferir",
                        "INSTRUIR AL CHOFER: Recopilar datos del otro veh√≠culo y heridos",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto",
                        "VERIFICAR: Estado f√≠sico y emocional del chofer"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema"
                    ]
                },
                { 
                    value: "choque_multiples_sin_heridos", 
                    text: "Choque m√∫ltiple sin heridos", 
                    peso: 6,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Mantener calma y no moverse del lugar",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: NO admitir responsabilidad ni discutir",
                        "INSTRUIR AL CHOFER: Recopilar datos de TODOS los veh√≠culos involucrados",
                        "INSTRUIR AL CHOFER: Tomar fotos de la escena completa",
                        "VERIFICAR: Que no hay heridos en ning√∫n veh√≠culo",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "choque_multiples_con_heridos", 
                    text: "Choque m√∫ltiple con heridos", 
                    peso: 15,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO mover a los heridos bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: Tomar fotos de la escena sin interferir",
                        "INSTRUIR AL CHOFER: Recopilar datos de TODOS los veh√≠culos y heridos",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto",
                        "VERIFICAR: Estado f√≠sico y emocional del chofer"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema"
                    ]
                },
                { 
                    value: "vuelco_sin_heridos", 
                    text: "Vuelco sin heridos", 
                    peso: 8,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: NO intentar enderezar el veh√≠culo",
                        "INSTRUIR AL CHOFER: Salir del veh√≠culo con cuidado si es posible",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: Verificar si hay otros ocupantes en el veh√≠culo",
                        "INSTRUIR AL CHOFER: Tomar fotos del hecho desde diferentes √°ngulos",
                        "VERIFICAR: Que no hay heridos ni da√±os a terceros",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema"
                    ]
                },
                { 
                    value: "vuelco_con_heridos", 
                    text: "Vuelco con heridos", 
                    peso: 15,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO mover a los heridos bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Salir del veh√≠culo con cuidado si es posible",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: Verificar si hay otros ocupantes en el veh√≠culo",
                        "INSTRUIR AL CHOFER: Tomar fotos del hecho sin interferir",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema"
                    ]
                },
                { 
                    value: "atropello", 
                    text: "Atropello", 
                    peso: 18,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO mover a la v√≠ctima bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: Tomar fotos de la escena SIN tocar nada",
                        "INSTRUIR AL CHOFER: Recopilar datos de contacto de la v√≠ctima si es posible",
                        "INSTRUIR AL CHOFER: NO admitir responsabilidad ni discutir",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema"
                    ]
                },
                { 
                    value: "accidente_mortal", 
                    text: "Accidente mortal", 
                    peso: 25,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO tocar NADA en la escena",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia y colocar balizas",
                        "INSTRUIR AL CHOFER: Tomar fotos de lejos sin interferir",
                        "INSTRUIR AL CHOFER: NO admitir responsabilidad ni discutir",
                        "INSTRUIR AL CHOFER: Avisar a familiares si es posible",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema"
                    ]
                }
            ],
            robo: [
                { 
                    value: "robo_simple", 
                    text: "Robo simple", 
                    peso: 6,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar a la polic√≠a al 911",
                        "INSTRUIR AL CHOFER: NO perseguir a los delincuentes",
                        "INSTRUIR AL CHOFER: Mantener calma y no resistirse",
                        "INSTRUIR AL CHOFER: Tomar fotos del lugar del robo si es seguro",
                        "INSTRUIR AL CHOFER: Recopilar descripci√≥n detallada de los delincuentes",
                        "VERIFICAR: Estado f√≠sico y emocional del chofer",
                        "RECOPILAR: DNI, licencia, seguro del chofer y descripci√≥n del robo"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "robo_con_amenaza", 
                    text: "Robo con amenaza", 
                    peso: 10,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO resistirse ni discutir con los delincuentes",
                        "INSTRUIR AL CHOFER: Mantener calma y cooperar",
                        "INSTRUIR AL CHOFER: Recopilar descripci√≥n detallada de los delincuentes",
                        "INSTRUIR AL CHOFER: Tomar fotos si es seguro hacerlo",
                        "VERIFICAR: Si hay heridos o lesiones",
                        "RECOPILAR: DNI, licencia, seguro del chofer y estado emocional"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "robo_armado", 
                    text: "Robo armado", 
                    peso: 18,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO resistirse bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Mantener calma y cooperar completamente",
                        "INSTRUIR AL CHOFER: Recopilar descripci√≥n detallada de delincuentes y armas",
                        "INSTRUIR AL CHOFER: Tomar fotos si es seguro hacerlo",
                        "VERIFICAR: Si hay heridos o lesiones",
                        "RECOPILAR: DNI, licencia, seguro del chofer y estado f√≠sico"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "secuestro", 
                    text: "Secuestro", 
                    peso: 25,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO dar consejos sobre negociaci√≥n",
                        "INSTRUIR AL CHOFER: Mantener comunicaci√≥n constante si es posible",
                        "INSTRUIR AL CHOFER: Recopilar descripci√≥n del veh√≠culo y delincuentes",
                        "INSTRUIR AL CHOFER: NO intentar escapar o resistirse",
                        "VERIFICAR: Estado f√≠sico y emocional del chofer",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto familiar"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                },
                {
                    value: "robo_en_curso",
                    text: "Robo en curso",
                    peso: 25,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO intentar resistirse ni dar caza a los delincuentes",
                        "INSTRUIR AL CHOFER: Recopilar descripci√≥n detallada de los delincuentes y veh√≠culo",
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                }
            ],
            averia: [
                { 
                    value: "averia_menor_sin_bloqueo", 
                    text: "Aver√≠a menor sin bloqueo", 
                    peso: 2,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente la aver√≠a",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje de forma segura",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia si est√° detenido",
                        "INSTRUIR AL CHOFER: Colocar balizas si est√° en la v√≠a",
                        "VERIFICAR: Que el veh√≠culo no obstruye la circulaci√≥n",
                    ],
                    acciones: [
                        "Llamar a Guardia de Mantenimiento",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "averia_menor_con_bloqueo", 
                    text: "Aver√≠a menor con bloqueo", 
                    peso: 5,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente la aver√≠a",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: Colocar balizas a 50 metros del veh√≠culo",
                        "INSTRUIR AL CHOFER: Tomar fotos de la situaci√≥n",
                        "VERIFICAR: Que el veh√≠culo obstruye la v√≠a",
                        "RECOPILAR: DNI, licencia, seguro del chofer y ubicaci√≥n exacta"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia de Mantenimiento",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "averia_mayor_sin_bloqueo", 
                    text: "Aver√≠a mayor sin bloqueo", 
                    peso: 6,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente la aver√≠a",
                        "INSTRUIR AL CHOFER: NO intentar reparar la aver√≠a",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia si est√° detenido",
                        "INSTRUIR AL CHOFER: Colocar balizas si est√° en la v√≠a",
                        "INSTRUIR AL CHOFER: Tomar fotos de la aver√≠a",
                        "VERIFICAR: Estado del conductor y si hay otros ocupantes",
                        "RECOPILAR: DNI, licencia, seguro del chofer y ubicaci√≥n exacta"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia de Mantenimiento",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "averia_mayor_con_bloqueo", 
                    text: "Aver√≠a mayor con bloqueo", 
                    peso: 10,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente la aver√≠a",
                        "INSTRUIR AL CHOFER: NO intentar reparar la aver√≠a",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: Colocar balizas a 50 metros del veh√≠culo",
                        "INSTRUIR AL CHOFER: Tomar fotos de la aver√≠a y bloqueo",
                        "VERIFICAR: Estado del conductor y si hay otros ocupantes",
                        "RECOPILAR: DNI, licencia, seguro del chofer y ubicaci√≥n exacta"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia de Mantenimiento",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica.",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "averia_motor", 
                    text: "Aver√≠a de motor", 
                    peso: 8,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente la aver√≠a del motor",
                        "INSTRUIR AL CHOFER: NO intentar reparar la aver√≠a",
                        "INSTRUIR AL CHOFER: Verificar temperatura del motor",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia si est√° detenido",
                        "INSTRUIR AL CHOFER: Tomar fotos del motor si es seguro",
                        "VERIFICAR: Si hay humo o l√≠quidos derramados",
                        "RECOPILAR: DNI, licencia, seguro del chofer y ubicaci√≥n exacta"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia de Mantenimiento",
                        "Registrar como aver√≠a cr√≠tica en el sistema",
                        "Solicitar al chofer que contacte mec√°nico especializado"
                    ]
                },
                { 
                    value: "averia_frenos", 
                    text: "Aver√≠a de frenos", 
                    peso: 12,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente el problema de frenos",
                        "INSTRUIR AL CHOFER: NO continuar el viaje bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: Colocar balizas a 50 metros del veh√≠culo",
                        "INSTRUIR AL CHOFER: Tomar fotos del veh√≠culo detenido",
                        "VERIFICAR: Que el veh√≠culo est√° detenido de forma segura",
                        "RECOPILAR: DNI, licencia, seguro del chofer y ubicaci√≥n exacta"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia de Mantenimiento",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar como aver√≠a cr√≠tica m√°xima en el sistema",
                    ]
                }
            ],
            derrame: [
                { 
                    value: "derrame_menor", 
                    text: "Derrame menor", 
                    peso: 8,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar a bomberos al 100",
                        "INSTRUIR AL CHOFER: NO tocar el material derramado",
                        "INSTRUIR AL CHOFER: Alejarse del √°rea del derrame",
                        "INSTRUIR AL CHOFER: Tomar fotos desde distancia segura",
                        "INSTRUIR AL CHOFER: Consultar la hoja de seguridad del material",
                        "VERIFICAR: Que no hay riesgo de propagaci√≥n",
                        "RECOPILAR: DNI, licencia, seguro del chofer y tipo de material derramado"
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema",
                        "Solicitar al chofer que contacte empresa de limpieza especializada"
                    ]
                },
                { 
                    value: "derrame_peligroso", 
                    text: "Derrame peligroso", 
                    peso: 15,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar bomberos 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: NO tocar el material bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Alejarse inmediatamente del √°rea",
                        "INSTRUIR AL CHOFER: Consultar la hoja de seguridad del material",
                        "INSTRUIR AL CHOFER: Tomar fotos desde distancia segura",
                        "VERIFICAR: Si hay riesgo de propagaci√≥n o explosi√≥n",
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "fuego_vehiculo", 
                    text: "Fuego en veh√≠culo", 
                    peso: 18,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar bomberos 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: Alejarse del veh√≠culo inmediatamente",
                        "INSTRUIR AL CHOFER: NO intentar apagar el fuego",
                        "INSTRUIR AL CHOFER: Tomar fotos desde distancia segura",
                        "INSTRUIR AL CHOFER: Verificar si hay otros ocupantes",
                        "VERIFICAR: Si hay riesgo de explosi√≥n",
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "fuego_carga", 
                    text: "Fuego en carga", 
                    peso: 22,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar bomberos 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: Alejarse del veh√≠culo inmediatamente",
                        "INSTRUIR AL CHOFER: NO intentar apagar el fuego",
                        "INSTRUIR AL CHOFER: Evacuar √°rea de 500 metros",
                        "INSTRUIR AL CHOFER: Tomar fotos desde distancia segura",
                        "VERIFICAR: Si hay riesgo de explosi√≥n",
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "explosion", 
                    text: "Explosi√≥n", 
                    peso: 30,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Llamar 911 INMEDIATAMENTE",
                        "INSTRUIR AL CHOFER: Alejarse inmediatamente del √°rea",
                        "INSTRUIR AL CHOFER: Evacuar √°rea de 1 kil√≥metro",
                        "INSTRUIR AL CHOFER: NO regresar al √°rea bajo ninguna circunstancia",
                        "INSTRUIR AL CHOFER: Tomar fotos desde distancia segura",
                        "VERIFICAR: Si hay heridos en el √°rea",
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Diego y Damian",
                        "Si no responden, llamar al que est√° de guardia de log√≠stica URGENTE",
                        "Registrar en el sistema",
                    ]
                }
            ],
            documentacion: [
                { 
                    value: "documentacion_faltante", 
                    text: "Documentaci√≥n faltante", 
                    peso: 1,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir qu√© documentaci√≥n espec√≠fica falta",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "VERIFICAR: Qu√© documentos espec√≠ficos necesita",
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                },
                { 
                    value: "documentacion_vencida", 
                    text: "Documentaci√≥n vencida", 
                    peso: 2,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir qu√© documento est√° vencido",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "INSTRUIR AL CHOFER: Contactar a la empresa para renovaci√≥n urgente",
                        "VERIFICAR: Fecha de vencimiento del documento",
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)",
                    ]
                },
                { 
                    value: "documentacion_incorrecta", 
                    text: "Documentaci√≥n incorrecta", 
                    peso: 1,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir qu√© informaci√≥n est√° incorrecta",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "INSTRUIR AL CHOFER: Contactar a la empresa para correcci√≥n",
                        "VERIFICAR: Qu√© informaci√≥n espec√≠fica est√° incorrecta",
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                }
            ],
            operaciones_cliente: [
                { 
                    value: "carga_cliente", 
                    text: "Problema en carga de mercader√≠a", 
                    peso: 1,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente el problema de carga",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "INSTRUIR AL CHOFER: Contactar al cliente para coordinar",
                        "VERIFICAR: Ubicaci√≥n exacta del cliente",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto del cliente"
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                },
                { 
                    value: "descarga_cliente", 
                    text: "Problema en descarga de mercader√≠a", 
                    peso: 1,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente el problema de descarga",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "INSTRUIR AL CHOFER: Contactar al cliente para coordinar",
                        "VERIFICAR: Ubicaci√≥n exacta del cliente",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto del cliente"
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                },
                { 
                    value: "acceso_cliente", 
                    text: "Problema de acceso al cliente", 
                    peso: 2,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente el problema de acceso",
                        "INSTRUIR AL CHOFER: Verificar horarios del cliente",
                        "INSTRUIR AL CHOFER: Contactar al cliente para coordinar",
                        "VERIFICAR: Ubicaci√≥n exacta y horarios del cliente",
                        "RECOPILAR: DNI, licencia, seguro del chofer y datos de contacto del cliente"
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)",
                    ]
                }
            ],
            combustible: [
                { 
                    value: "sin_combustible", 
                    text: "Sin combustible - no puede continuar", 
                    peso: 10,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir la situaci√≥n de combustible",
                        "INSTRUIR AL CHOFER: Verificar si el veh√≠culo est√° en lugar seguro",
                        "INSTRUIR AL CHOFER: Encender luces de emergencia si est√° en la v√≠a",
                        "INSTRUIR AL CHOFER: Colocar balizas si est√° en la v√≠a",
                        "VERIFICAR: Ubicaci√≥n exacta del veh√≠culo",
                    ],
                    acciones: [
                        "Llamar INMEDIATAMENTE a Guardia Log√≠stica",
                        "Registrar en el sistema",
                    ]
                },
                { 
                    value: "no_sabe_donde_cargar", 
                    text: "No sabe d√≥nde cargar combustible", 
                    peso: 1,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "VERIFICAR: Ubicaci√≥n exacta para buscar estaciones cercanas",
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                },
                { 
                    value: "problema_estacion", 
                    text: "Problema en estaci√≥n de servicio", 
                    peso: 1,
                    indicaciones: [
                        "INSTRUIR AL CHOFER: Describir detalladamente el problema en la estaci√≥n",
                        "INSTRUIR AL CHOFER: Verificar si puede continuar el viaje",
                        "INSTRUIR AL CHOFER: Buscar estaciones alternativas cercanas",
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                }
            ],
            consulta: [
                { 
                    value: "consulta_rutina", 
                    text: "Consulta rutinaria", 
                    peso: 0,
                    indicaciones: [
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                },
                { 
                    value: "consulta_urgencia", 
                    text: "Consulta urgente", 
                    peso: 10,
                    indicaciones: [
                    ],
                    acciones: [
                        "Llamar a Guardia Log√≠stica",
                    ]
                },
                { 
                    value: "consulta_tecnica", 
                    text: "Consulta t√©cnica", 
                    peso: 1,
                    indicaciones: [
                    ],
                    acciones: [
                        "Registrar en el sistema para horario de oficina (07:00-21:00)"
                    ]
                }
            ]
        };



        // Actualizar subtipos cuando cambia el tipo de incidente
        function actualizarSubtipos() {
            const tipoSelect = document.getElementById('tipo');
            const subtipoSelect = document.getElementById('subtipo');
            const tipoSeleccionado = tipoSelect.value;
            
            // Limpiar opciones de subtipo
            subtipoSelect.innerHTML = '<option value="">Seleccionar subtipo...</option>';
            
            if (tipoSeleccionado && SUBTIPOS_INCIDENTE[tipoSeleccionado]) {
                SUBTIPOS_INCIDENTE[tipoSeleccionado].forEach(subtipo => {
                    const option = document.createElement('option');
                    option.value = subtipo.value;
                    option.textContent = subtipo.text;
                    option.setAttribute('data-peso', subtipo.peso);
                    subtipoSelect.appendChild(option);
                });
            }
            
            // Recalcular clasificaci√≥n
            clasificar();
        }

        // Calcular puntaje total basado en tipo y subtipo de incidente
        function calcularPuntaje() {
            let puntaje = 0;
            
            // Sumar puntos del tipo de incidente
            const tipoSelect = document.getElementById('tipo');
            const tipoOption = tipoSelect.selectedOptions[0];
            if (tipoOption && tipoOption.getAttribute('data-peso')) {
                puntaje += parseInt(tipoOption.getAttribute('data-peso')) || 0;
            }
            
            // Sumar puntos del subtipo de incidente
            const subtipoSelect = document.getElementById('subtipo');
            const subtipoOption = subtipoSelect.selectedOptions[0];
            if (subtipoOption && subtipoOption.getAttribute('data-peso')) {
                puntaje += parseInt(subtipoOption.getAttribute('data-peso')) || 0;
            }
            
            return puntaje;
        }

        // Determinar nivel de riesgo basado en el puntaje
        function determinarNivelRiesgo(puntaje) {
            const niveles = Object.keys(NIVELES_RIESGO).sort((a, b) => 
                NIVELES_RIESGO[b].puntajeMinimo - NIVELES_RIESGO[a].puntajeMinimo
            );
            
            for (const nivel of niveles) {
                if (puntaje >= NIVELES_RIESGO[nivel].puntajeMinimo) {
                    return nivel;
                }
            }
            
            return 'BAJO'; // Nivel por defecto
        }

        // Mostrar indicaciones de seguridad
        function mostrarIndicaciones() {
            const indicacionesContainer = document.getElementById('indicacionesContainer');
            const indicacionesLista = document.getElementById('indicacionesLista');
            
            // Obtener indicaciones del subtipo seleccionado
            const subtipoSelect = document.getElementById('subtipo');
            const tipoSelect = document.getElementById('tipo');
            const subtipoSeleccionado = subtipoSelect.value;
            const tipoSeleccionado = tipoSelect.value;
            
            let hayIndicaciones = false;
            indicacionesLista.innerHTML = '';
            
            // Mostrar indicaciones espec√≠ficas del subtipo
            if (subtipoSeleccionado && tipoSeleccionado && SUBTIPOS_INCIDENTE[tipoSeleccionado]) {
                const subtipoConfig = SUBTIPOS_INCIDENTE[tipoSeleccionado].find(s => s.value === subtipoSeleccionado);
                
                if (subtipoConfig && subtipoConfig.indicaciones) {
                    hayIndicaciones = true;
                    
                    const subtipoDiv = document.createElement('div');
                    subtipoDiv.className = 'mb-4';
                    subtipoDiv.innerHTML = `<h4 class="font-medium text-blue-800 mb-2">üìã Indicaciones para ${subtipoConfig.text}</h4>`;
                    indicacionesLista.appendChild(subtipoDiv);
                    
                    subtipoConfig.indicaciones.forEach(indicacion => {
                        const div = document.createElement('div');
                        div.className = 'flex items-start space-x-2 p-2 bg-blue-50 rounded border border-blue-200 mb-2';
                        div.innerHTML = `
                            <span class="text-blue-600 font-medium">‚Ä¢</span>
                            <p class="text-sm text-gray-700">${indicacion}</p>
                        `;
                        indicacionesLista.appendChild(div);
                    });
                }
                
                // Mostrar acciones espec√≠ficas del subtipo
                if (subtipoConfig && subtipoConfig.acciones) {
                    hayIndicaciones = true;
                    
                    const accionesDiv = document.createElement('div');
                    accionesDiv.className = 'mb-4';
                    accionesDiv.innerHTML = `<h4 class="font-medium text-green-800 mt-1 mb-2">‚ö° Acciones para ${subtipoConfig.text}</h4>`;
                    indicacionesLista.appendChild(accionesDiv);
                    
                    subtipoConfig.acciones.forEach(accion => {
                        const div = document.createElement('div');
                        div.className = 'flex items-start space-x-2 p-2 bg-green-50 rounded border border-green-200 mb-2';
                        div.innerHTML = `
                            <span class="text-green-600 font-medium">‚úì</span>
                            <p class="text-sm text-gray-700">${accion}</p>
                        `;
                        indicacionesLista.appendChild(div);
                    });
                }
            }
            
            if (hayIndicaciones) {
                indicacionesContainer.classList.remove('hidden');
            } else {
                indicacionesContainer.classList.add('hidden');
            }
        }

        // Clasificar autom√°ticamente
        function clasificar() {
            const puntaje = calcularPuntaje();
            const nivel = determinarNivelRiesgo(puntaje);
            const configNivel = NIVELES_RIESGO[nivel];

            // Mostrar indicaciones de seguridad
            mostrarIndicaciones();

            // Mostrar puntaje en tiempo real
            const puntajeContainer = document.getElementById('puntajeContainer');
            const puntajeActual = document.getElementById('puntajeActual');
            
            if (puntajeContainer && puntajeActual) {
                puntajeActual.textContent = puntaje;
                if (puntaje > 0) {
                    puntajeContainer.classList.remove('hidden');
                } else {
                    puntajeContainer.classList.add('hidden');
                }
            }

            // Mostrar clasificaci√≥n
            const div = document.getElementById('clasificacion');
            const titulo = document.getElementById('clasificacionTitulo');
            const desc = document.getElementById('clasificacionDescripcion');

            // Aplicar colores din√°micos
            const colorClasses = {
                red: 'bg-red-100 text-red-800',
                orange: 'bg-orange-100 text-orange-800',
                yellow: 'bg-yellow-100 text-yellow-800',
                green: 'bg-green-100 text-green-800'
            };

            div.className = `p-4 rounded-md ${colorClasses[configNivel.color] || 'bg-gray-100 text-gray-800'}`;
            titulo.textContent = "Clasificaci√≥n: " + configNivel.titulo;
            
            let descripcionCompleta = `Puntaje: ${puntaje} | Responsable: ${configNivel.responsable}`;
            
            desc.textContent = descripcionCompleta;
            div.classList.remove('hidden');
        }

        // Enviar a Make
        async function enviarAMake(datos) {
            try {
                const response = await fetch(MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                return response.ok;
            } catch (error) {
                console.error('Error:', error);
                return false;
            }
        }

        // Limpiar formulario
        function limpiarFormulario() {
            // Limpiar campos de texto
            document.getElementById('nombre').value = '';
            document.getElementById('telefono').value = '';
            document.getElementById('motivo').value = '';
            document.getElementById('ubicacion').value = '';
            document.getElementById('patente').value = '';
            
            // Limpiar selects
            document.getElementById('categoria').value = '';
            document.getElementById('tipo').value = '';
            document.getElementById('subtipo').innerHTML = '<option value="">Seleccionar subtipo...</option>';
            
            // Establecer fecha y hora actual
            const ahora = new Date();
            document.getElementById('fecha').value = ahora.toISOString().split('T')[0];
            document.getElementById('hora').value = ahora.toTimeString().slice(0,5);
            
            // Ocultar elementos din√°micos
            document.getElementById('clasificacion').classList.add('hidden');
            document.getElementById('indicacionesContainer').classList.add('hidden');
            
            // Limpiar estilos de error
            const campos = ['patente', 'ubicacion', 'motivo'];
            campos.forEach(campo => {
                document.getElementById(campo).classList.remove('border-red-500');
            });
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Fecha y hora actual
            const ahora = new Date();
            document.getElementById('fecha').value = ahora.toISOString().split('T')[0];
            document.getElementById('hora').value = ahora.toTimeString().slice(0,5);


            // Eventos para tipo de incidente y subtipo
            document.getElementById('tipo').addEventListener('change', function() {
                actualizarSubtipos();
                clasificar();
                validarEnTiempoReal();
            });
            
            document.getElementById('subtipo').addEventListener('change', function() {
                clasificar();
                validarEnTiempoReal();
            });


            // Validaci√≥n en tiempo real
            function validarEnTiempoReal() {
                const errores = validarIncidente();
                const patenteField = document.getElementById('patente');
                const ubicacionField = document.getElementById('ubicacion');
                const motivoField = document.getElementById('motivo');
                
                // Limpiar estilos de error previos
                patenteField.classList.remove('border-red-500');
                ubicacionField.classList.remove('border-red-500');
                motivoField.classList.remove('border-red-500');
                
                // Aplicar estilos de error seg√∫n validaciones
                if (errores.some(e => e.includes('patente'))) {
                    patenteField.classList.add('border-red-500');
                }
                if (errores.some(e => e.includes('ubicaci√≥n'))) {
                    ubicacionField.classList.add('border-red-500');
                }
                if (errores.some(e => e.includes('motivo'))) {
                    motivoField.classList.add('border-red-500');
                }
            }

            // Eventos para validaci√≥n en tiempo real
            document.getElementById('patente').addEventListener('input', validarEnTiempoReal);
            document.getElementById('ubicacion').addEventListener('input', validarEnTiempoReal);
            document.getElementById('motivo').addEventListener('input', validarEnTiempoReal);

            // Validaciones espec√≠ficas seg√∫n tipo y subtipo
            function validarIncidente() {
                const tipo = document.getElementById('tipo').value;
                const subtipo = document.getElementById('subtipo').value;
                const patente = document.getElementById('patente').value;
                const ubicacion = document.getElementById('ubicacion').value;
                const motivo = document.getElementById('motivo').value;
                
                let errores = [];
                
                // Validaciones espec√≠ficas por tipo de incidente
                if (tipo === 'accidente') {
                    if (!patente.trim()) {
                        errores.push('La patente es obligatoria para accidentes');
                    }
                    if (ubicacion.length < 5) {
                        errores.push('La ubicaci√≥n debe ser m√°s detallada para accidentes (m√≠nimo 5 caracteres)');
                    }
                }
                
                if (tipo === 'robo') {
                    if (!patente.trim()) {
                        errores.push('La patente es obligatoria para robos');
                    }
                    if (motivo.length < 5) {
                        errores.push('El motivo debe ser m√°s detallado para robos (m√≠nimo 5 caracteres)');
                    }
                }
                
                if (tipo === 'derrame') {
                    if (ubicacion.length < 5) {
                        errores.push('La ubicaci√≥n debe ser muy detallada para derrames (m√≠nimo 5 caracteres)');
                    }
                    if (motivo.length < 5) {
                        errores.push('El motivo debe describir detalladamente el derrame (m√≠nimo 5 caracteres)');
                    }
                }
                
                // Validaciones espec√≠ficas por subtipo
                if (subtipo === 'accidente_mortal' || subtipo === 'secuestro' || subtipo === 'explosion') {
                    if (motivo.length < 5) {
                        errores.push('Para incidentes cr√≠ticos, el motivo debe ser muy detallado (m√≠nimo 5 caracteres)');
                    }
                }
                
                if (subtipo === 'averia_frenos') {
                    if (!patente.trim()) {
                        errores.push('La patente es obligatoria para aver√≠as de frenos');
                    }
                }
                
                return errores;
            }

            // Enviar formulario
            document.getElementById('incidenteForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                // Validar formulario
                const errores = validarIncidente();
                if (errores.length > 0) {
                    alert('‚ùå Errores de validaci√≥n:\n\n' + errores.join('\n'));
                    return;
                }


                // Obtener indicaciones y acciones del subtipo
                const tipo = document.getElementById('tipo').value;
                const subtipo = document.getElementById('subtipo').value;
                let indicacionesSubtipo = [];
                let accionesSubtipo = [];
                
                if (tipo && subtipo && SUBTIPOS_INCIDENTE[tipo]) {
                    const subtipoConfig = SUBTIPOS_INCIDENTE[tipo].find(s => s.value === subtipo);
                    if (subtipoConfig) {
                        indicacionesSubtipo = subtipoConfig.indicaciones || [];
                        accionesSubtipo = subtipoConfig.acciones || [];
                    }
                }

                const datos = {
                    fecha: document.getElementById('fecha').value,
                    hora: document.getElementById('hora').value,
                    nombre: document.getElementById('nombre').value,
                    telefono: document.getElementById('telefono').value,
                    categoria: document.getElementById('categoria').value,
                    motivo: document.getElementById('motivo').value,
                    ubicacion: document.getElementById('ubicacion').value,
                    patente: document.getElementById('patente').value,
                    tipo: tipo,
                    subtipo: subtipo,
                    indicacionesSubtipo: indicacionesSubtipo,
                    accionesSubtipo: accionesSubtipo,
                    puntajeTotal: calcularPuntaje(),
                    nivelRiesgo: determinarNivelRiesgo(calcularPuntaje()),
                    timestamp: new Date().toISOString()
                };

                // Enviar a Make
                const enviado = await enviarAMake(datos);
                
                if (enviado) {
                    alert('‚úÖ ¬°Gracias por registrar el incidente!\n\nEl reporte ha sido enviado correctamente y el equipo ha sido notificado.');
                } else {
                    alert('‚ö†Ô∏è Error de conexi√≥n\n\nEl reporte se ha guardado localmente. Se intentar√° enviar nuevamente m√°s tarde.');
                }

                // Guardar localmente tambi√©n
                const incidentes = JSON.parse(localStorage.getItem('incidentes') || '[]');
                incidentes.push(datos);
                localStorage.setItem('incidentes', JSON.stringify(incidentes));

                // Limpiar formulario y preparar para nuevo reporte
                limpiarFormulario();
                alert('üìù Formulario listo para un nuevo reporte');
            });
        });
    </script>
</body>
</html>
