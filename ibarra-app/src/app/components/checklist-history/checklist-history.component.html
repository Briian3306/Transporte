<div class="checklist-history-container">
  <div class="header-section">
    <h2>Histórico de Checklists</h2>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="exportToExcel()">
        <i class="fas fa-file-excel"></i> Exportar Excel
      </button>
      <button class="btn btn-secondary" (click)="exportToPDF()">
        <i class="fas fa-file-pdf"></i> Exportar PDF
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="fechaInicio">Fecha Inicio:</label>
        <input 
          type="date" 
          id="fechaInicio" 
          [(ngModel)]="fechaInicio" 
          class="form-control">
      </div>
      
      <div class="filter-group">
        <label for="fechaFin">Fecha Fin:</label>
        <input 
          type="date" 
          id="fechaFin" 
          [(ngModel)]="fechaFin" 
          class="form-control">
      </div>
      
      <div class="filter-group">
        <label for="estadoFiltro">Estado:</label>
        <select 
          id="estadoFiltro" 
          [(ngModel)]="estadoFiltro" 
          class="form-control">
          <option value="todos">Todos</option>
          <option value="completado">Completado</option>
          <option value="con_errores">Con Errores</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="tipoRecursoFiltro">Tipo de Recurso:</label>
        <select 
          id="tipoRecursoFiltro" 
          [(ngModel)]="tipoRecursoFiltro" 
          class="form-control">
          <option value="todos">Todos</option>
          <option value="vehiculo">Vehículo</option>
          <option value="chofer">Chofer</option>
          <option value="unidad">Unidad</option>
          <option value="maquina">Máquina</option>
          <option value="sector">Sector</option>
          <option value="legacy">Legacy</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="nombreRecursoFiltro">Nombre del Recurso:</label>
        <input 
          type="text" 
          id="nombreRecursoFiltro" 
          [(ngModel)]="nombreRecursoFiltro" 
          placeholder="Buscar por nombre del recurso..."
          class="form-control"
          (input)="filterChecklists()">
      </div>
      
      <div class="filter-actions">
        <button class="btn btn-primary mr-1" (click)="applyFilters()">
          <i class="fas fa-search"></i> Buscar
        </button>
        <button class="btn btn-outline-secondary" (click)="clearFilters()">
          <i class="fas fa-times"></i> Limpiar
        </button>
      </div>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-section">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">{{ estadisticas.total }}</div>
        <div class="stat-label">Total Checklists</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ estadisticas.completados }}</div>
        <div class="stat-label">Completados</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ estadisticas.conErrores }}</div>
        <div class="stat-label">Con Errores</div>
      </div>
    </div>
  </div>

  <!-- Loading y Error -->
  <div *ngIf="loading" class="loading-section">
    <div class="spinner"></div>
    <p>Cargando checklists...</p>
  </div>

  <div *ngIf="error" class="error-section">
    <div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i>
      {{ error }}
    </div>
  </div>

  <!-- Tabla de Checklists -->
  <div *ngIf="!loading && !error" class="table-section">
    <div class="table-container">
      <table class="checklist-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Recurso</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Progreso</th>
            <th>Items</th>
            <th>Errores</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let checklist of getPaginatedChecklists()" class="checklist-row">
            <td>
              <div class="date-info">
                <div class="date">{{ checklist.fecha_realizacion | date:'dd/MM/yyyy' }}</div>
                <div class="time">{{ checklist.fecha_realizacion | date:'HH:mm' }}</div>
              </div>
            </td>
            <td>
              <div class="resource-info">
                <div class="resource-name">{{ getNombreRecurso(checklist) }}</div>
                <div class="resource-details" *ngIf="getRecursoInfo(checklist)">
                  <small class="text-muted">{{ getRecursoInfo(checklist).tipo_unidad || getRecursoInfo(checklist).modelo || '' }}</small>
                </div>
              </div>
            </td>
            <td>
              <span class="resource-type-badge" [ngClass]="'type-' + getTipoRecurso(checklist)">
                {{ getTipoRecurso(checklist) | titlecase }}
              </span>
            </td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(checklist.estado)">
                {{ getStatusText(checklist.estado) }}
              </span>
            </td>
            <td>
              <div class="progress-container">
                <div class="progress-bar">
                  <div 
                    class="progress-fill" 
                    [style.width.%]="checklist.porcentaje_completado"
                    [ngClass]="{
                      'progress-success': checklist.porcentaje_completado >= 90,
                      'progress-warning': checklist.porcentaje_completado >= 70 && checklist.porcentaje_completado < 90,
                      'progress-danger': checklist.porcentaje_completado < 70
                    }">
                  </div>
                </div>
                <span class="progress-text">{{ checklist.porcentaje_completado | number:'1.1-1' }}%</span>
              </div>
            </td>
            <td>
              <div class="items-info">
                <span class="items-completed">{{ checklist.items_completados }}</span>
                <span class="items-separator">/</span>
                <span class="items-total">{{ checklist.total_items }}</span>
              </div>
            </td>
            <td>
              <span *ngIf="checklist.items_con_error > 0" class="error-count">
                <i class="fas fa-exclamation-circle"></i>
                {{ checklist.items_con_error }}
              </span>
              <span *ngIf="checklist.items_con_error === 0" class="no-errors">
                <i class="fas fa-check-circle"></i>
                0
              </span>
            </td>
            <td>
              <button 
                class="btn btn-sm btn-primary" 
                (click)="viewChecklistDetails(checklist)"
                title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <div *ngIf="totalPages > 1" class="pagination-section">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} - 
        {{ getEndRecordNumber() }} 
        de {{ filteredChecklists.length }} registros
      </div>
      
      <div class="pagination-controls">
        <button 
          class="btn btn-sm btn-outline-primary" 
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)">
          <i class="fas fa-chevron-left"></i>
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="btn btn-sm"
          [ngClass]="page === currentPage ? 'btn-primary' : 'btn-outline-primary'"
          (click)="onPageChange(page)">
          {{ page }}
        </button>
        
        <button 
          class="btn btn-sm btn-outline-primary" 
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay datos -->
  <div *ngIf="!loading && !error && filteredChecklists.length === 0" class="no-data-section">
    <div class="no-data-content">
      <i class="fas fa-clipboard-list"></i>
      <h3>No se encontraron checklists</h3>
      <p>No hay checklists que coincidan con los filtros seleccionados.</p>
      <button class="btn btn-primary" (click)="clearFilters()">
        Limpiar
      </button>
    </div>
  </div>
</div>